# è®¤è¯ç®¡ç†ç­–ç•¥æ–‡æ¡£

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº† Hushie.AI åº”ç”¨çš„è®¤è¯ç®¡ç†ç­–ç•¥ï¼ŒåŒ…æ‹¬è®¤è¯çŠ¶æ€ç®¡ç†ã€Token ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€ç½‘ç»œå¥åº·æ£€æŸ¥é›†æˆã€å¤±è´¥å¤„ç†æœºåˆ¶ä»¥åŠä¼˜åŒ–ç­–ç•¥ã€‚

## ç›®å½•

1. [æ¶æ„æ¦‚è§ˆ](#æ¶æ„æ¦‚è§ˆ)
2. [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
3. [è®¤è¯æµç¨‹](#è®¤è¯æµç¨‹)
4. [Token ç®¡ç†ç­–ç•¥](#token-ç®¡ç†ç­–ç•¥)
5. [ç½‘ç»œå¥åº·æ£€æŸ¥é›†æˆ](#ç½‘ç»œå¥åº·æ£€æŸ¥é›†æˆ)
6. [å¤±è´¥å¤„ç†ä¸é‡è¯•æœºåˆ¶](#å¤±è´¥å¤„ç†ä¸é‡è¯•æœºåˆ¶)
7. [HTTP å®¢æˆ·ç«¯ 401 å¤„ç†](#http-å®¢æˆ·ç«¯-401-å¤„ç†)
8. [ä¼˜åŒ–ç­–ç•¥](#ä¼˜åŒ–ç­–ç•¥)
9. [å®‰å…¨è€ƒè™‘](#å®‰å…¨è€ƒè™‘)
10. [æµ‹è¯•å»ºè®®](#æµ‹è¯•å»ºè®®)

## æ¶æ„æ¦‚è§ˆ

è®¤è¯ç®¡ç†ç³»ç»Ÿé‡‡ç”¨äº‹ä»¶é©±åŠ¨çš„æ¶æ„ï¼Œä»¥ `AuthManager` ä¸ºæ ¸å¿ƒï¼Œé›†æˆç½‘ç»œå¥åº·æ£€æŸ¥ã€HTTP å®¢æˆ·ç«¯æœåŠ¡å’Œå®‰å…¨å­˜å‚¨æœåŠ¡ï¼Œæä¾›ç»Ÿä¸€çš„è®¤è¯çŠ¶æ€ç®¡ç†ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   UI ç»„ä»¶å±‚     â”‚    â”‚   ä¸šåŠ¡é€»è¾‘å±‚     â”‚    â”‚   æœåŠ¡å±‚        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ LoginPage       â”‚    â”‚ AuthManager      â”‚    â”‚ GoogleAuthServiceâ”‚
â”‚ ProfilePage     â”‚â—„â”€â”€â–ºâ”‚ (å•ä¾‹æ¨¡å¼)       â”‚â—„â”€â”€â–ºâ”‚ HttpClientServiceâ”‚
â”‚ SplashPage      â”‚    â”‚ è®¤è¯çŠ¶æ€ç®¡ç†     â”‚    â”‚ NetworkHealthy   â”‚
â”‚ ...             â”‚    â”‚ Token ç”Ÿå‘½å‘¨æœŸ   â”‚    â”‚ SecureStorage    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ ¸å¿ƒç»„ä»¶

### 1. AuthManager (è®¤è¯ç®¡ç†å™¨)

**ä½ç½®**: `lib/services/auth_manager.dart`

**èŒè´£**:
- ç®¡ç†è®¤è¯çŠ¶æ€å’Œç”¨æˆ·ä¿¡æ¯
- Token ç”Ÿå‘½å‘¨æœŸç®¡ç†å’Œè‡ªåŠ¨åˆ·æ–°
- è®¤è¯çŠ¶æ€å˜åŒ–äº‹ä»¶åˆ†å‘
- ç½‘ç»œå¥åº·æ£€æŸ¥é›†æˆ
- å®‰å…¨å­˜å‚¨ç®¡ç†

**å…³é”®ç‰¹æ€§**:
- å•ä¾‹æ¨¡å¼è®¾è®¡
- äº‹ä»¶é©±åŠ¨çš„çŠ¶æ€ç®¡ç†
- è‡ªåŠ¨ Token åˆ·æ–°æœºåˆ¶
- ç½‘ç»œå¥åº·é¢„æ£€
- ä¼˜é›…çš„å¤±è´¥å¤„ç†

### 2. HttpClientService (HTTP å®¢æˆ·ç«¯æœåŠ¡)

**ä½ç½®**: `lib/services/http_client_service.dart`

**èŒè´£**:
- ç»Ÿä¸€çš„ HTTP è¯·æ±‚å¤„ç†
- 401 çŠ¶æ€ç è‡ªåŠ¨å¤„ç†
- è¯·æ±‚é‡è¯•æœºåˆ¶
- é”™è¯¯æ¶ˆæ¯ç»Ÿä¸€ç®¡ç†

### 3. NetworkHealthyManager (ç½‘ç»œå¥åº·ç®¡ç†å™¨)

**ä½ç½®**: `lib/services/network_healthy_manager.dart`

**èŒè´£**:
- ç½‘ç»œè¿æ¥çŠ¶æ€æ£€æµ‹
- æœåŠ¡å™¨å¥åº·çŠ¶æ€æ£€æŸ¥
- ç½‘ç»œçŠ¶æ€å˜åŒ–ç›‘å¬

### 4. ToastMessages (æ¶ˆæ¯ç®¡ç†)

**ä½ç½®**: `lib/utils/toast_messages.dart`

**èŒè´£**:
- é›†ä¸­ç®¡ç†æ‰€æœ‰ Toast æ¶ˆæ¯
- å¤šè¯­è¨€æ”¯æŒ (è‹±æ–‡)
- ç»Ÿä¸€çš„é”™è¯¯æ¶ˆæ¯æ ¼å¼

## è®¤è¯æµç¨‹

### 1. åº”ç”¨å¯åŠ¨æµç¨‹

```mermaid
sequenceDiagram
    participant App as åº”ç”¨å¯åŠ¨
    participant Auth as AuthManager
    participant Storage as SecureStorage
    participant Network as NetworkHealthy
    
    App->>Auth: initialize()
    Auth->>Storage: åŠ è½½å­˜å‚¨çš„ Token
    Auth->>Auth: æ£€æŸ¥ Token æœ‰æ•ˆæ€§
    alt Token æœ‰æ•ˆ
        Auth->>App: è®¤è¯çŠ¶æ€: authenticated
    else Token æ— æ•ˆæˆ–ä¸å­˜åœ¨
        Auth->>App: è®¤è¯çŠ¶æ€: unauthenticated
    end
```

### 2. ç”¨æˆ·ç™»å½•æµç¨‹

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant UI as LoginPage
    participant Auth as AuthManager
    participant Network as NetworkHealthy
    participant Google as GoogleAuthService
    
    User->>UI: ç‚¹å‡»ç™»å½•
    UI->>Auth: signInWithGoogle()
    Auth->>Network: æ£€æŸ¥ç½‘ç»œå¥åº·
    alt ç½‘ç»œä¸å¥åº·
        Auth->>UI: æ˜¾ç¤ºç½‘ç»œä¸å¯ç”¨æç¤º
    else ç½‘ç»œå¥åº·
        Auth->>Google: æ‰§è¡Œ Google ç™»å½•
        Google->>Auth: è¿”å›è®¤è¯ç»“æœ
        Auth->>Auth: ä¿å­˜ Token å’Œç”¨æˆ·ä¿¡æ¯
        Auth->>UI: é€šçŸ¥è®¤è¯çŠ¶æ€å˜åŒ–
    end
```

### 3. Token åˆ·æ–°æµç¨‹

```mermaid
sequenceDiagram
    participant Timer as å®šæ—¶å™¨/è¯·æ±‚
    participant Auth as AuthManager
    participant Network as NetworkHealthy
    participant Google as GoogleAuthService
    
    Timer->>Auth: æ£€æŸ¥ Token è¿‡æœŸ
    Auth->>Network: ç½‘ç»œå¥åº·é¢„æ£€
    alt ç½‘ç»œä¸å¥åº·
        Auth->>Auth: è·³è¿‡åˆ·æ–°ï¼Œä¿ç•™ç°çŠ¶
    else ç½‘ç»œå¥åº·
        Auth->>Google: refreshAccessToken()
        alt åˆ·æ–°æˆåŠŸ
            Google->>Auth: è¿”å›æ–° Token
            Auth->>Auth: ä¿å­˜æ–° Token
        else ç½‘ç»œ/è¶…æ—¶é”™è¯¯
            Auth->>Auth: ä¿ç•™ç°çŠ¶ï¼Œç¨åé‡è¯•
        else æœåŠ¡å™¨åˆ¤å®šæ— æ•ˆ
            Auth->>Auth: æ¸…é™¤ Tokenï¼Œé€€å‡ºç™»å½•
        end
    end
```

## Token ç®¡ç†ç­–ç•¥

### 1. Token å­˜å‚¨

- **å­˜å‚¨ä½ç½®**: ä½¿ç”¨ `SecureStorageService` è¿›è¡Œå®‰å…¨å­˜å‚¨
- **å­˜å‚¨å†…å®¹**:
  - `accessToken`: è®¿é—®ä»¤ç‰Œ
  - `refreshToken`: åˆ·æ–°ä»¤ç‰Œ
  - `expiresAt`: è¿‡æœŸæ—¶é—´æˆ³
  - `userInfo`: ç”¨æˆ·ä¿¡æ¯ JSON

### 2. Token ç”Ÿå‘½å‘¨æœŸ

```dart
class AccessTokenResponse {
  final String accessToken;
  final String refreshToken;
  final int expiresIn;
  final String tokenType;
  final int expiresAt;
  
  // æ£€æŸ¥æ˜¯å¦å³å°†è¿‡æœŸ (æå‰5åˆ†é’Ÿ)
  bool get isExpiringSoon {
    final now = DateTime.now().millisecondsSinceEpoch ~/ 1000;
    return (expiresAt - now) <= 300; // 5åˆ†é’Ÿ
  }
}
```

### 3. è‡ªåŠ¨åˆ·æ–°æœºåˆ¶

- **è§¦å‘æ¡ä»¶**:
  - Token å³å°†è¿‡æœŸ (æå‰5åˆ†é’Ÿ)
  - HTTP è¯·æ±‚è¿”å› 401 çŠ¶æ€ç 
  - æ‰‹åŠ¨è°ƒç”¨ `refreshToken()`

- **å¹¶å‘æ§åˆ¶**: ä½¿ç”¨ `Future` ç¼“å­˜é˜²æ­¢é‡å¤åˆ·æ–°
- **è¶…æ—¶å¤„ç†**: 35ç§’è¶…æ—¶æœºåˆ¶
- **é‡è¯•ç­–ç•¥**: æŒ‡æ•°é€€é¿é‡è¯• (æœ€å¤š2æ¬¡)

### 4. å¤±è´¥åˆ†ç±»å¤„ç†

```dart
// ç½‘ç»œ/è¶…æ—¶é”™è¯¯ (errNo == -1 æˆ–å¼‚å¸¸)
if (result.errNo == -1 || e is TimeoutException) {
  // ä¿ç•™ç°æœ‰ç™»å½•æ€ï¼Œä¸æ¸…é™¤ Token
  return false;
}

// æœåŠ¡å™¨åˆ¤å®šæ— æ•ˆ (å…¶ä»–é”™è¯¯ç )
else {
  // æ¸…é™¤ Tokenï¼Œé€€å‡ºç™»å½•æ€
  await clearAllAuthData();
  return false;
}
```

## ç½‘ç»œå¥åº·æ£€æŸ¥é›†æˆ

### 1. æ£€æŸ¥æ—¶æœº

- **ç™»å½•å‰**: `signInWithGoogle()` è°ƒç”¨å‰
- **Token åˆ·æ–°å‰**: `_performTokenRefresh()` è°ƒç”¨å‰

### 2. æ£€æŸ¥é€»è¾‘

```dart
Future<bool> _ensureNetworkHealthy({String action = ''}) async {
  try {
    final status = await NetworkHealthyManager.instance.checkNetworkHealth();
    if (status == NetworkHealthStatus.healthy) {
      return true;
    }
    ToastHelper.showError(ToastMessages.networkUnavailable);
    return false;
  } catch (e) {
    ToastHelper.showError(ToastMessages.networkCheckFailed);
    return false;
  }
}
```

### 3. ç½‘ç»œçŠ¶æ€ç±»å‹

- `NetworkHealthStatus.healthy`: ç½‘ç»œå¥åº·
- `NetworkHealthStatus.noConnection`: æ— ç½‘ç»œè¿æ¥
- `NetworkHealthStatus.serverUnhealthy`: æœåŠ¡å™¨ä¸å¥åº·
- `NetworkHealthStatus.error`: æ£€æŸ¥å¼‚å¸¸

## å¤±è´¥å¤„ç†ä¸é‡è¯•æœºåˆ¶

### 1. AuthManager é‡è¯•ç­–ç•¥

```dart
// Token åˆ·æ–°é‡è¯• (æŒ‡æ•°é€€é¿)
for (int i = 1; i <= 2; i++) {
  final delayMs = 1000 * i; // 1ç§’, 2ç§’
  await Future.delayed(Duration(milliseconds: delayMs));
  bool success = await _performTokenRefresh();
  if (success) return true;
}
```

### 2. isSignedIn() ä¼˜åŒ–ç­–ç•¥

- **è½¯å¤±è´¥**: åˆ·æ–°å¤±è´¥æ—¶ä¸ç«‹å³æ¸…é™¤ç™»å½•æ€
- **ä¿ç•™ç°çŠ¶**: å…è®¸åç»­é‡è¯•æˆ–å®šæ—¶å™¨å¤„ç†
- **å¼‚å¸¸å¤„ç†**: ä»…åœ¨ä¸¥é‡å¼‚å¸¸æ—¶æ¸…é™¤è®¤è¯æ•°æ®

### 3. é”™è¯¯åˆ†ç±»

| é”™è¯¯ç±»å‹ | å¤„ç†ç­–ç•¥ | ç¤ºä¾‹ |
|---------|---------|------|
| ç½‘ç»œé”™è¯¯ | ä¿ç•™ç™»å½•æ€ï¼Œç¨åé‡è¯• | ç½‘ç»œè¶…æ—¶ã€è¿æ¥å¤±è´¥ |
| æœåŠ¡å™¨æ— æ•ˆ | æ¸…é™¤ç™»å½•æ€ï¼Œé€€å‡ºç™»å½• | 401 Unauthorized |
| ç³»ç»Ÿå¼‚å¸¸ | æ¸…é™¤ç™»å½•æ€ï¼Œå®‰å…¨é€€å‡º | å­˜å‚¨å¼‚å¸¸ã€è§£æé”™è¯¯ |

## HTTP å®¢æˆ·ç«¯ 401 å¤„ç†

### 1. ç»Ÿä¸€ 401 å¤„ç†æµç¨‹

```dart
// æ£€æµ‹åˆ° 401 çŠ¶æ€ç 
if (response.statusCode == 401) {
  // å°è¯•åˆ·æ–° Token
  final refreshed = await AuthManager.instance.refreshToken();
  if (refreshed) {
    // åˆ·æ–°æˆåŠŸï¼Œé‡å‘åŸè¯·æ±‚
    return await request();
  } else {
    // åˆ·æ–°å¤±è´¥ï¼Œæ˜¾ç¤ºè®¤è¯è¿‡æœŸæç¤º
    ToastHelper.showError(ToastMessages.authExpired);
    return response; // è¿”å›åŸ 401 å“åº”
  }
}
```

### 2. é‡è¯•é…ç½®

- **æœ€å¤§é‡è¯•æ¬¡æ•°**: 3æ¬¡
- **é‡è¯•é—´éš”**: 500ms
- **é‡è¯•çŠ¶æ€ç **: [404, 500, 502, 503, 504]
- **401 ç‰¹æ®Šå¤„ç†**: å•ç‹¬çš„ Token åˆ·æ–°é‡è¯•

### 3. é”™è¯¯æ¶ˆæ¯ç®¡ç†

æ‰€æœ‰ HTTP é”™è¯¯æ¶ˆæ¯ç»Ÿä¸€é€šè¿‡ `ToastMessages` ç®¡ç†ï¼Œæ”¯æŒ:
- çŠ¶æ€ç é”™è¯¯æ¶ˆæ¯
- ç½‘ç»œå¼‚å¸¸æ¶ˆæ¯
- è®¤è¯ç›¸å…³æ¶ˆæ¯

## ä¼˜åŒ–ç­–ç•¥

### 1. å·²å®ç°çš„ä¼˜åŒ–

#### ç½‘ç»œå¥åº·é¢„æ£€
- **ç›®çš„**: é¿å…ç½‘ç»œé—®é¢˜å¯¼è‡´çš„è¯¯ç™»å‡º
- **å®ç°**: ç™»å½•å’Œåˆ·æ–°å‰æ£€æŸ¥ç½‘ç»œçŠ¶æ€
- **æ•ˆæœ**: å‡å°‘å› ç½‘ç»œé—®é¢˜å¯¼è‡´çš„è®¤è¯å¤±è´¥

#### å¤±è´¥åˆ†ç±»å¤„ç†
- **ç›®çš„**: åŒºåˆ†ç½‘ç»œé”™è¯¯å’Œè®¤è¯é”™è¯¯
- **å®ç°**: æ ¹æ®é”™è¯¯ç±»å‹é‡‡ç”¨ä¸åŒå¤„ç†ç­–ç•¥
- **æ•ˆæœ**: æé«˜ç³»ç»Ÿå®¹é”™æ€§

#### æŒ‡æ•°é€€é¿é‡è¯•
- **ç›®çš„**: ä¼˜é›…å¤„ç†ä¸´æ—¶ç½‘ç»œé—®é¢˜
- **å®ç°**: Token åˆ·æ–°å¤±è´¥æ—¶è¿›è¡Œ2æ¬¡é€€é¿é‡è¯•
- **æ•ˆæœ**: æé«˜åˆ·æ–°æˆåŠŸç‡

#### ç»Ÿä¸€ 401 å¤„ç†
- **ç›®çš„**: è‡ªåŠ¨å¤„ç†è®¤è¯è¿‡æœŸé—®é¢˜
- **å®ç°**: HTTP å®¢æˆ·ç«¯è‡ªåŠ¨åˆ·æ–° Token å¹¶é‡è¯•
- **æ•ˆæœ**: æå‡ç”¨æˆ·ä½“éªŒ

### 2. æ€§èƒ½ä¼˜åŒ–

#### å¹¶å‘æ§åˆ¶
```dart
// é˜²æ­¢é‡å¤åˆ·æ–°
if (_refreshFuture != null) {
  return await _refreshFuture!;
}
```

#### æ‰¹é‡å­˜å‚¨è¯»å–
```dart
// ä¸€æ¬¡æ€§è¯»å–æ‰€æœ‰è®¤è¯æ•°æ®
final authData = await SecureStorageService.getAllAuthData();
```

#### ç¼“å­˜æœºåˆ¶
- Token å†…å­˜ç¼“å­˜
- è®¾å¤‡ ID ç¼“å­˜
- åŠ¨æ€ç­¾åç¼“å­˜

### 3. ç”¨æˆ·ä½“éªŒä¼˜åŒ–

#### ç»Ÿä¸€é”™è¯¯æç¤º
- é›†ä¸­ç®¡ç†é”™è¯¯æ¶ˆæ¯
- è‹±æ–‡ç”¨æˆ·å‹å¥½æç¤º
- é¿å…æŠ€æœ¯æœ¯è¯­

#### çŠ¶æ€é€æ˜åŒ–
- å®æ—¶è®¤è¯çŠ¶æ€é€šçŸ¥
- è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—
- æ¸…æ™°çš„çŠ¶æ€æµè½¬

## å®‰å…¨è€ƒè™‘

### 1. Token å®‰å…¨

- **å®‰å…¨å­˜å‚¨**: ä½¿ç”¨ç³»ç»Ÿå®‰å…¨å­˜å‚¨æœåŠ¡
- **å†…å­˜ä¿æŠ¤**: é¿å… Token é•¿æœŸé©»ç•™å†…å­˜
- **ä¼ è¾“å®‰å…¨**: HTTPS åŠ å¯†ä¼ è¾“

### 2. è®¤è¯æµç¨‹å®‰å…¨

- **è¶…æ—¶æ§åˆ¶**: é˜²æ­¢é•¿æ—¶é—´ç­‰å¾…
- **é‡è¯•é™åˆ¶**: é¿å…æ— é™é‡è¯•
- **çŠ¶æ€éªŒè¯**: ä¸¥æ ¼çš„çŠ¶æ€æ£€æŸ¥

### 3. é”™è¯¯å¤„ç†å®‰å…¨

- **ä¿¡æ¯æ³„éœ²é˜²æŠ¤**: ä¸åœ¨æ—¥å¿—ä¸­è¾“å‡ºæ•æ„Ÿä¿¡æ¯
- **å¼‚å¸¸å¤„ç†**: ä¼˜é›…å¤„ç†æ‰€æœ‰å¼‚å¸¸æƒ…å†µ
- **å®‰å…¨é€€å‡º**: å¼‚å¸¸æ—¶å®‰å…¨æ¸…é™¤è®¤è¯æ•°æ®

## æµ‹è¯•å»ºè®®

### 1. ç½‘ç»œæ¡ä»¶æµ‹è¯•

```bash
# å¼±ç½‘ç»œç¯å¢ƒæµ‹è¯•
- ç½‘ç»œå»¶è¿Ÿ > 5ç§’
- é—´æ­‡æ€§ç½‘ç»œä¸­æ–­
- DNS è§£æå¤±è´¥

# æœåŠ¡å™¨å¼‚å¸¸æµ‹è¯•
- æœåŠ¡å™¨è¿”å› 500 é”™è¯¯
- æœåŠ¡å™¨è¶…æ—¶
- æœåŠ¡å™¨è¿”å›æ— æ•ˆå“åº”
```

### 2. Token ç”Ÿå‘½å‘¨æœŸæµ‹è¯•

```bash
# Token è¿‡æœŸæµ‹è¯•
- æ‰‹åŠ¨è®¾ç½®è¿‡æœŸæ—¶é—´
- æ¨¡æ‹ŸæœåŠ¡å™¨æ—¶é—´ä¸åŒæ­¥
- æµ‹è¯•è‡ªåŠ¨åˆ·æ–°æœºåˆ¶

# æ— æ•ˆ Token æµ‹è¯•
- ä½¿ç”¨è¿‡æœŸçš„ refresh_token
- ä½¿ç”¨è¢«æ’¤é”€çš„ token
- æµ‹è¯•æœåŠ¡å™¨ 401 å“åº”
```

### 3. å¹¶å‘åœºæ™¯æµ‹è¯•

```bash
# å¹¶å‘åˆ·æ–°æµ‹è¯•
- å¤šä¸ªè¯·æ±‚åŒæ—¶è§¦å‘åˆ·æ–°
- åº”ç”¨å¯åŠ¨æ—¶çš„å¹¶å‘æ£€æŸ¥
- ç½‘ç»œæ¢å¤æ—¶çš„æ‰¹é‡é‡è¯•
```

### 4. å¼‚å¸¸æ¢å¤æµ‹è¯•

```bash
# åº”ç”¨ç”Ÿå‘½å‘¨æœŸæµ‹è¯•
- åº”ç”¨åå°/å‰å°åˆ‡æ¢
- åº”ç”¨å¼ºåˆ¶å…³é—­é‡å¯
- ç³»ç»Ÿé‡å¯åçš„çŠ¶æ€æ¢å¤

# å­˜å‚¨å¼‚å¸¸æµ‹è¯•
- å­˜å‚¨ç©ºé—´ä¸è¶³
- å­˜å‚¨æƒé™è¢«æ‹’ç»
- å­˜å‚¨æ•°æ®æŸå
```

## ç›‘æ§å’Œè°ƒè¯•

### 1. æ—¥å¿—ç³»ç»Ÿ

```dart
// è®¤è¯ç›¸å…³æ—¥å¿—å‰ç¼€
debugPrint('ğŸ” [AUTH] è®¤è¯çŠ¶æ€å˜åŒ–: $status');
debugPrint('ğŸ”„ [RETRY] Tokenåˆ·æ–°é‡è¯•: $attempt');
debugPrint('ğŸŒ [NETWORK] ç½‘ç»œå¥åº·æ£€æŸ¥: $status');
```

### 2. å…³é”®æŒ‡æ ‡ç›‘æ§

- Token åˆ·æ–°æˆåŠŸç‡
- ç½‘ç»œå¥åº·æ£€æŸ¥æˆåŠŸç‡
- 401 å¤„ç†æˆåŠŸç‡
- ç”¨æˆ·ç™»å½•æˆåŠŸç‡

### 3. å¼‚å¸¸ç›‘æ§

- Token åˆ·æ–°å¤±è´¥æ¬¡æ•°
- ç½‘ç»œæ£€æŸ¥å¼‚å¸¸æ¬¡æ•°
- è®¤è¯æµç¨‹å¼‚å¸¸æ¬¡æ•°
- å­˜å‚¨æ“ä½œå¤±è´¥æ¬¡æ•°

## æ€»ç»“

æœ¬è®¤è¯ç®¡ç†ç­–ç•¥é€šè¿‡ä»¥ä¸‹å…³é”®ç‰¹æ€§ç¡®ä¿äº†ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒ:

1. **ç½‘ç»œå¥åº·é¢„æ£€**: é¿å…ç½‘ç»œé—®é¢˜å¯¼è‡´çš„è¯¯ç™»å‡º
2. **æ™ºèƒ½å¤±è´¥å¤„ç†**: åŒºåˆ†ç½‘ç»œé”™è¯¯å’Œè®¤è¯é”™è¯¯
3. **è‡ªåŠ¨é‡è¯•æœºåˆ¶**: æŒ‡æ•°é€€é¿å’Œç»Ÿä¸€ 401 å¤„ç†
4. **äº‹ä»¶é©±åŠ¨æ¶æ„**: å®æ—¶çŠ¶æ€åŒæ­¥å’Œå“åº”
5. **å®‰å…¨å­˜å‚¨ç®¡ç†**: ä¿æŠ¤ç”¨æˆ·è®¤è¯æ•°æ®
6. **ç»Ÿä¸€é”™è¯¯ç®¡ç†**: ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º

è¿™äº›ä¼˜åŒ–ç­–ç•¥æ˜¾è‘—é™ä½äº†å› ç½‘ç»œé—®é¢˜å¯¼è‡´çš„ç™»å½•çŠ¶æ€ä¸¢å¤±ï¼Œæå‡äº†åº”ç”¨çš„å¯é æ€§å’Œç”¨æˆ·æ»¡æ„åº¦ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2024å¹´12æœˆ  
**ç»´æŠ¤è€…**: Hushie.AI å¼€å‘å›¢é˜Ÿ